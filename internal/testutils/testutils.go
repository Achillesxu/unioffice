//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package testutils ;import (_ce "crypto/md5";_a "encoding/hex";_gd "errors";_ge "fmt";_faf "image";_fa "image/png";_ed "io";_g "os";_d "os/exec";_f "path/filepath";_ced "strings";_e "testing";);func HashFile (file string )(string ,error ){_fc ,_ddc :=_g .Open (file );if _ddc !=nil {return "",_ddc ;};defer _fc .Close ();_fcf :=_ce .New ();if _ ,_ddc =_ed .Copy (_fcf ,_fc );_ddc !=nil {return "",_ddc ;};return _a .EncodeToString (_fcf .Sum (nil )),nil ;};var (ErrRenderNotSupported =_gd .New ("\u0072\u0065\u006e\u0064\u0065r\u0069\u006e\u0067\u0020\u0050\u0044\u0046\u0020\u0066\u0069\u006c\u0065\u0073 \u0069\u0073\u0020\u006e\u006f\u0074\u0020\u0073\u0075\u0070\u0070\u006f\u0072\u0074\u0065\u0064\u0020\u006f\u006e\u0020\u0074\u0068\u0069\u0073\u0020\u0073\u0079\u0073\u0074\u0065m"););func ReadPNG (file string )(_faf .Image ,error ){_da ,_dd :=_g .Open (file );if _dd !=nil {return nil ,_dd ;};defer _da .Close ();return _fa .Decode (_da );};func CopyFile (src ,dst string )error {_fe ,_aa :=_g .Open (src );if _aa !=nil {return _aa ;};defer _fe .Close ();_cd ,_aa :=_g .Create (dst );if _aa !=nil {return _aa ;};defer _cd .Close ();_ ,_aa =_ed .Copy (_cd ,_fe );return _aa ;};func CompareImages (img1 ,img2 _faf .Image )(bool ,error ){_gc :=img1 .Bounds ();_fb :=0;for _b :=0;_b < _gc .Size ().X ;_b ++{for _ag :=0;_ag < _gc .Size ().Y ;_ag ++{_ef ,_eda ,_df ,_ :=img1 .At (_b ,_ag ).RGBA ();_ad ,_fea ,_bd ,_ :=img2 .At (_b ,_ag ).RGBA ();if _ef !=_ad ||_eda !=_fea ||_df !=_bd {_fb ++;};};};_ca :=float64 (_fb )/float64 (_gc .Dx ()*_gc .Dy ());if _ca > 0.0001{_ge .Printf ("\u0064\u0069\u0066f \u0066\u0072\u0061\u0063\u0074\u0069\u006f\u006e\u003a\u0020\u0025\u0076\u0020\u0028\u0025\u0064\u0029\u000a",_ca ,_fb );return false ,nil ;};return true ,nil ;};func RenderPDFToPNGs (pdfPath string ,dpi int ,outpathTpl string )error {if dpi <=0{dpi =100;};if _ ,_efe :=_d .LookPath ("\u0067\u0073");_efe !=nil {return ErrRenderNotSupported ;};return _d .Command ("\u0067\u0073","\u002d\u0073\u0044\u0045\u0056\u0049\u0043\u0045\u003d\u0070\u006e\u0067a\u006c\u0070\u0068\u0061","\u002d\u006f",outpathTpl ,_ge .Sprintf ("\u002d\u0072\u0025\u0064",dpi ),pdfPath ).Run ();};func ComparePNGFiles (file1 ,file2 string )(bool ,error ){_caf ,_ab :=HashFile (file1 );if _ab !=nil {return false ,_ab ;};_adg ,_ab :=HashFile (file2 );if _ab !=nil {return false ,_ab ;};if _caf ==_adg {return true ,nil ;};_dag ,_ab :=ReadPNG (file1 );if _ab !=nil {return false ,_ab ;};_ccf ,_ab :=ReadPNG (file2 );if _ab !=nil {return false ,_ab ;};if _dag .Bounds ()!=_ccf .Bounds (){return false ,nil ;};return CompareImages (_dag ,_ccf );};func RunRenderTest (t *_e .T ,pdfPath ,outputDir ,baselineRenderPath string ,saveBaseline bool ){_fed :=_ced .TrimSuffix (_f .Base (pdfPath ),_f .Ext (pdfPath ));t .Run ("\u0072\u0065\u006e\u0064\u0065\u0072",func (_ac *_e .T ){_dfb :=_f .Join (outputDir ,_fed );_cde :=_dfb +"\u002d%\u0064\u002e\u0070\u006e\u0067";if _gf :=RenderPDFToPNGs (pdfPath ,0,_cde );_gf !=nil {_ac .Skip (_gf );};for _cb :=1;true ;_cb ++{_gdf :=_ge .Sprintf ("\u0025s\u002d\u0025\u0064\u002e\u0070\u006eg",_dfb ,_cb );_de :=_f .Join (baselineRenderPath ,_ge .Sprintf ("\u0025\u0073\u002d\u0025\u0064\u005f\u0065\u0078\u0070\u002e\u0070\u006e\u0067",_fed ,_cb ));if _ ,_cbc :=_g .Stat (_gdf );_cbc !=nil {break ;};_ac .Logf ("\u0025\u0073",_de );if saveBaseline {_ac .Logf ("\u0043\u006fp\u0079\u0069\u006eg\u0020\u0025\u0073\u0020\u002d\u003e\u0020\u0025\u0073",_gdf ,_de );_gca :=CopyFile (_gdf ,_de );if _gca !=nil {_ac .Fatalf ("\u0045\u0052\u0052OR\u0020\u0063\u006f\u0070\u0079\u0069\u006e\u0067\u0020\u0074\u006f\u0020\u0025\u0073\u003a\u0020\u0025\u0076",_de ,_gca );};continue ;};_ac .Run (_ge .Sprintf ("\u0070\u0061\u0067\u0065\u0025\u0064",_cb ),func (_db *_e .T ){_db .Logf ("\u0043o\u006dp\u0061\u0072\u0069\u006e\u0067 \u0025\u0073 \u0076\u0073\u0020\u0025\u0073",_gdf ,_de );_ga ,_bb :=ComparePNGFiles (_gdf ,_de );if _g .IsNotExist (_bb ){_db .Fatal ("\u0069m\u0061g\u0065\u0020\u0066\u0069\u006ce\u0020\u006di\u0073\u0073\u0069\u006e\u0067");}else if !_ga {_db .Fatal ("\u0077\u0072\u006f\u006eg \u0070\u0061\u0067\u0065\u0020\u0072\u0065\u006e\u0064\u0065\u0072\u0065\u0064");};});};});};